let library=[];const lines=document.querySelectorAll(".line"),keyMap=new Map;let currentLineIndex=0,currentWord,currentWordMetrics,genericPopupTimeout,isGameOver=!1,areInstructionsShown=!0;const styleNames={SHOW_POPUP:"show",POPULATED_LETTER:"populated",SHAKE_LETTER:"shake",SHAKE_LINE:"shake-line",NOTFOUND_LETTER:"not-found",INCORRECT_LOCATION_LETTER:"incorrect-location",CORRECT_LOCATION:"correct-location",KEY_PRESS:"press",DEFAULT_KEY_STYLES:["key","enter","backspace"]};function addKeyEvents(){document.querySelectorAll(".key").forEach(e=>{const t=e.getAttribute("value");t&&(keyMap.set(t,e),e.addEventListener("mousedown",()=>{keypress(t),showPressedKey(t)}),e.addEventListener("mouseup",()=>{removePressedKey(t)}))}),window.addEventListener("keydown",e=>{keypress(e.key),showPressedKey(e.key)}),window.addEventListener("keyup",e=>{removePressedKey(e.key)})}function addGiveUpEvents(){document.querySelector("#give-up").addEventListener("click",()=>{currentLineIndex=lines.length,checkIfEndGame()})}function addInstructionEvents(){const t=document.querySelector("#instructions");[document.querySelector("#close-instructions"),document.querySelector("#instruction-bg")].forEach(e=>{e.addEventListener("click",()=>{t.classList.add("hide"),areInstructionsShown=!1})}),document.querySelector("#show-instructions").addEventListener("click",()=>{t.classList.remove("hide"),areInstructionsShown=!0}),t.classList.remove("hide"),areInstructionsShown=!0}function addPlayAgainEvents(){document.querySelector("#playAgainYes").addEventListener("click",e=>{resetGame()}),document.querySelector("#playAgainNo").addEventListener("click",e=>{document.querySelector("#playAgain").classList.remove(styleNames.SHOW_POPUP)})}function showPressedKey(e){e=keyMap.get(e.toUpperCase());e&&e.classList.add(styleNames.KEY_PRESS)}function removePressedKey(e){e=keyMap.get(e.toUpperCase());e&&e.classList.remove(styleNames.KEY_PRESS)}function getCurrentWord(){var e=Math.floor(Math.random()*library.length);return library[e].toUpperCase()}function setWordMetrics(e){const n=new Map;return e&&e.split("").forEach((e,t)=>{var r=n.get(e)||[];n.set(e,[...r,t])}),n}function keypress(e){var t,r,n;if(!(areInstructionsShown||isGameOver||!e||lines.length<=currentLineIndex))return"ENTER"===e.toUpperCase()?validateValue():"BACKSPACE"===e.toUpperCase()?removeLetter():void(1!==e.length||(e=e.toUpperCase(),t="A".charCodeAt(0),r="Z".charCodeAt(0),(n=e.charCodeAt(0))<t)||r<n||addLetter(e))}function getCurrentLineLetters(){return Array.from(lines[currentLineIndex].querySelectorAll(".letter"))}function removeLetter(){var e=getCurrentLineLetters().reverse().find(e=>0!==e.innerHTML?.length);e&&(e.innerHTML="",e.classList.remove(styleNames.POPULATED_LETTER),shakeLetter(e))}function addLetter(e){var t=getCurrentLineLetters().find(e=>0===e.innerHTML?.length);t&&(t.innerHTML=e,t.classList.add(styleNames.POPULATED_LETTER),shakeLetter(t))}function shakeLetter(e){e.classList.add(styleNames.SHAKE_LETTER),setTimeout(()=>{e.classList.remove(styleNames.SHAKE_LETTER)},250)}function shakeLine(e){e.classList.add(styleNames.SHAKE_LINE),setTimeout(()=>{e.classList.remove(styleNames.SHAKE_LINE)},500)}function validateValue(){var e,t=getCurrentLineLetters();t.find(e=>0===e.innerHTML?.length)?(showGenericPopup("Not enough letters"),shakeLine(lines[currentLineIndex])):(e=t.map(e=>e.innerHTML).join("").toLowerCase(),library.includes(e)?Array.from(lines).filter((e,t)=>t!==currentLineIndex).map(e=>Array.from(e.querySelectorAll(".letter")).map(e=>e.innerHTML).join("").toLowerCase()).filter(e=>0<e.length).includes(e)?(showGenericPopup("Word already added."),shakeLine(lines[currentLineIndex])):(t.forEach((e,t)=>{var r=e.innerHTML,n=currentWordMetrics.get(r)||[],r=keyMap.get(r);0===n.length?(e.classList.add(styleNames.NOTFOUND_LETTER),setKeyStyle(r,styleNames.NOTFOUND_LETTER)):(n=void 0===n.find(e=>e===t)?styleNames.INCORRECT_LOCATION_LETTER:styleNames.CORRECT_LOCATION,e.classList.add(n),setKeyStyle(r,n))}),currentLineIndex++,checkIfEndGame()):(showGenericPopup("Not in word list."),shakeLine(lines[currentLineIndex])))}function setKeyStyle(e,t){1===e.classList.length&&e.classList.add(t)}function showGenericPopup(e){const t=document.querySelector("#genericPopup");t&&(t.classList.add(styleNames.SHOW_POPUP),t.querySelector("#genericMessage").innerHTML=e),genericPopupTimeout||clearInterval(genericPopupTimeout),genericPopupTimeout=setTimeout(()=>{t.classList.remove(styleNames.SHOW_POPUP)},1e3)}function checkIfEndGame(){var e=lines[currentLineIndex-1];Array.from(e.querySelectorAll(".letter")).map(e=>e.innerHTML).join("")===currentWord.toUpperCase()?(document.querySelector("#wonPopup").classList.add(styleNames.SHOW_POPUP),isGameOver=!0):lines.length<=currentLineIndex&&((e=document.querySelector("#failurePopup"))&&(showPuzzleWord(e.querySelector("#puzzleWord")),e.classList.add(styleNames.SHOW_POPUP)),isGameOver=!0),isGameOver&&document.querySelector("#playAgain").classList.add(styleNames.SHOW_POPUP)}function showPuzzleWord(r){r&&currentWord&&currentWord.split("").forEach(e=>{var t=document.createElement("span"),e=(t.innerHTML=e,keyMap.get(e)),e=Array.from(e.classList);e.includes(styleNames.INCORRECT_LOCATION_LETTER)?t.classList.add(styleNames.INCORRECT_LOCATION_LETTER):e.includes(styleNames.CORRECT_LOCATION)?t.classList.add(styleNames.CORRECT_LOCATION):t.classList.add(styleNames.NOTFOUND_LETTER),r.appendChild(t)})}function resetGame(){Array.from(document.querySelectorAll(".popup")).forEach(e=>{e.classList.remove(styleNames.SHOW_POPUP)}),Array.from(document.querySelectorAll(".letter")).forEach(e=>{e.innerHTML="",e.classList=["letter"]}),Array.from(keyMap.values()).forEach(e=>{var t=Array.from(e.classList).filter(e=>styleNames.DEFAULT_KEY_STYLES.includes(e));e.classList=t.join(" ")});var e=document.querySelector("#genericPopup");e&&(e.querySelector("#genericMessage").innerHTML=""),document.querySelector("#puzzleWord").innerHTML="",currentLineIndex=0,currentWord=getCurrentWord(),currentWordMetrics=setWordMetrics(currentWord),isGameOver=!1,genericPopupTimeout&&(clearInterval(genericPopupTimeout),genericPopupTimeout=null)}async function getLibrary(){return(await(await fetch("data/library.json")).json()).library}async function startGame(){library=await getLibrary(),currentWord=getCurrentWord(),currentWordMetrics=setWordMetrics(currentWord),addKeyEvents(),addInstructionEvents(),addGiveUpEvents(),addPlayAgainEvents()}startGame();