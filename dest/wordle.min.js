const library=["event"],lines=document.querySelectorAll(".line");let currentLineIndex=0,currentWord,currentWordMetrics,showNotEnoughTimeout,isGameOver=!1;const styleNames={SHOW_POPUP:"show",POPULATED_LETTER:"populated",SHAKE_LETTER:"shake",SHAKE_LINE:"shake-line",NOTFOUND_LETTER:"not-found",INCORRECT_LOCATION_LETTER:"incorrect-location",CORRECT_LOCATION:"correct-location",DEFAULT_KEY_STYLES:["key","enter","backspace"]},getCurrentWord=(document.querySelectorAll(".key").forEach(e=>{e.addEventListener("click",e=>{keypress(e.target.value)})}),window.addEventListener("keydown",e=>{keypress(e.key)}),document.querySelector("#playAgainYes").addEventListener("click",e=>{resetGame()}),document.querySelector("#playAgainNo").addEventListener("click",e=>{document.querySelector("#playAgain").classList.remove(styleNames.SHOW_POPUP)}),()=>{var e=Math.floor(Math.random()*library.length);return library[e].toUpperCase()}),setWordMetrics=e=>{const s=new Map;return e&&e.split("").forEach((e,t)=>{var r=s.get(e)||[];s.set(e,[...r,t])}),s},keypress=e=>{var t,r,s;if(!(isGameOver||!e||lines.length<=currentLineIndex))return"ENTER"===e.toUpperCase()?validateValue():"BACKSPACE"===e.toUpperCase()?removeLetter():void(1!==e.length||(e=e.toUpperCase(),t="A".charCodeAt(0),r="Z".charCodeAt(0),(s=e.charCodeAt(0))<t)||r<s||addLetter(e))},getCurrentLineLetters=()=>Array.from(lines[currentLineIndex].querySelectorAll(".letter")),removeLetter=()=>{var e=getCurrentLineLetters().reverse().find(e=>0!==e.innerHTML?.length);e&&(e.innerHTML="",e.classList.remove(styleNames.POPULATED_LETTER),shakeLetter(e))},addLetter=e=>{var t=getCurrentLineLetters().find(e=>0===e.innerHTML?.length);t&&(t.innerHTML=e,t.classList.add(styleNames.POPULATED_LETTER),shakeLetter(t))},shakeLetter=e=>{e.classList.add(styleNames.SHAKE_LETTER),setTimeout(()=>{e.classList.remove(styleNames.SHAKE_LETTER)},250)},validateValue=()=>{var e=getCurrentLineLetters();e.find(e=>0===e.innerHTML?.length)?(lines[currentLineIndex].classList.add(styleNames.SHAKE_LINE),showNotEnough(),setTimeout(()=>{lines[currentLineIndex].classList.remove(styleNames.SHAKE_LINE)},500)):(e.forEach((e,t)=>{var r=e.innerHTML,s=currentWordMetrics.get(r)||[],r=document.querySelector(`.key[value='${r}']`);0===s.length?(e.classList.add(styleNames.NOTFOUND_LETTER),setKeyStyle(r,styleNames.NOTFOUND_LETTER)):(s=void 0===s.find(e=>e===t)?styleNames.INCORRECT_LOCATION_LETTER:styleNames.CORRECT_LOCATION,e.classList.add(s),setKeyStyle(r,s))}),currentLineIndex++,checkIfEndGame())},setKeyStyle=(e,t)=>{1===e.classList.length&&e.classList.add(t)},showNotEnough=()=>{const e=document.querySelector("#notEnoughLetters");e&&e.classList.add(styleNames.SHOW_POPUP),showNotEnoughTimeout||clearInterval(showNotEnoughTimeout),showNotEnoughTimeout=setTimeout(()=>{e.classList.remove(styleNames.SHOW_POPUP)},1e3)},checkIfEndGame=()=>{var e=lines[currentLineIndex-1];Array.from(e.querySelectorAll(".letter")).map(e=>e.innerHTML).join("")===currentWord.toUpperCase()?(document.querySelector("#wonPopup").classList.add(styleNames.SHOW_POPUP),isGameOver=!0):lines.length<=currentLineIndex&&((e=document.querySelector("#failurePopup"))&&(showPuzzleWord(e.querySelector("#puzzleWord")),e.classList.add(styleNames.SHOW_POPUP)),isGameOver=!0),isGameOver&&document.querySelector("#playAgain").classList.add(styleNames.SHOW_POPUP)},showPuzzleWord=s=>{if(s&&currentWord){const n=Array.from(document.querySelectorAll(".key"));currentWord.split("").forEach(t=>{var e=document.createElement("span"),r=(e.innerHTML=t,n.find(e=>e.getAttribute("value")===t)),r=Array.from(r.classList);r.includes(styleNames.INCORRECT_LOCATION_LETTER)?e.classList.add(styleNames.INCORRECT_LOCATION_LETTER):r.includes(styleNames.CORRECT_LOCATION)?e.classList.add(styleNames.CORRECT_LOCATION):e.classList.add(styleNames.NOTFOUND_LETTER),s.appendChild(e)})}},resetGame=()=>{Array.from(document.querySelectorAll(".popup")).forEach(e=>{e.classList.remove(styleNames.SHOW_POPUP)}),Array.from(document.querySelectorAll(".letter")).forEach(e=>{e.innerHTML="",e.classList=["letter"]}),Array.from(document.querySelectorAll(".key")).forEach(e=>{var t=Array.from(e.classList).filter(e=>styleNames.DEFAULT_KEY_STYLES.includes(e));e.classList=t.join(" ")}),document.querySelector("#puzzleWord").innerHTML="",currentLineIndex=0,currentWord=getCurrentWord(),setWordMetrics(currentWord),isGameOver=!1,showNotEnoughTimeout&&(clearInterval(showNotEnoughTimeout),showNotEnoughTimeout=null)},startGame=()=>{currentWord=getCurrentWord(),currentWordMetrics=setWordMetrics(currentWord)};startGame();